KeybGen.getCharFromSymbol=function(e){return e.substring(0,2)=="U+"?"&#x"+e.substring(2)+";":KeybGen.keysyms[e]>="0300"&&KeybGen.keysyms[e]<="036F"?"&#x25CC;&#x"+KeybGen.keysyms[e]+";":KeybGen.keysyms[e]!==undefined?"&#x"+KeybGen.keysyms[e]+";":""},KeybGen.getCharNumFromSymbol=function(e){return e.substring(0,2)=="U+"?e.substring(2):KeybGen.keysyms[e]>="0300"&&KeybGen.keysyms[e]<="036F"?"":KeybGen.keysyms[e]!==undefined?KeybGen.keysyms[e]:""},KeybGen.generateKeyboard=function(e,t){$("#keyboard").empty();var n=parseInt($("#keyboard").css("width")),r=KeybGen.geometries[e];for(var i in r){var s=$('<div class="row"></div>'),o=0;s.appendTo("#keyboard");for(var u in r[i]){if(KeybGen.symbols[t][u]||KeybGen.symbols[KeybGen.symbols[t].include][u]){if(KeybGen.symbols[t][u])var a=KeybGen.symbols[t][u];else a=KeybGen.symbols[KeybGen.symbols[t].include][u];a.length==2&&(a=a.concat(["",""]));var f=$.map(a,function(e){return KeybGen.getCharNumFromSymbol(e)}),l=$.map(a,function(e){return KeybGen.getCharFromSymbol(e)})}else a=["","","",""],f=["","","",""],l=[r[i][u].name||"","","",""];var c=$('<div class="key" data-keycode="'+u+'">');r[i][u].special?c.addClass("special"):c.addClass("alnum"),r[i][u].merged&&c.addClass("merged-"+r[i][u].merged),c.appendTo(s),c.append('<table class="key-table">');for(var h=0;h<=1;h++){c.find(".key-table").append('<tr class="level'+Math.abs(h-2)+'">');for(var p=0;p<=1;p++){var d=Math.abs(h-1)+p*2,v=$('<td class="group'+(p+1)+'" data-symbol="'+a[d]+'">');v.html(l[d]),c.find(".level"+Math.abs(h-2)).append(v),KeybGen.diffs[t][u]&&KeybGen.diffs[t][u][h+2*p]&&c.find(".level"+Math.abs(h-2)+" .group"+(p+1)).addClass(KeybGen.diffs[t][u][h+2*p])}}r[i][u].width&&c.css("width",Math.round(c.width()*r[i][u].width)+"px"),o+=c.outerWidth()}c.css("width",c.width()+(n-o)+"px")}},KeybGen.deselectKey=function(){$("#keyboard .selected").removeClass("selected"),$("#keydetails").removeData("keycode"),$("#keydetails td").html("")},KeybGen.selectKey=function(e){if(typeof e!="string")var t=$(this);else t=$('#keyboard div[data-keycode="'+e+'"]');var n=t.hasClass("selected");KeybGen.deselectKey();if(n)return;$("#keyboard .selected").removeClass("selected"),t.addClass("selected"),$("#keydetails").data("keycode",t.data("keycode"));var r=[".level1 .group1",".level2 .group1",".level1 .group2",".level2 .group2"];for(var i in r){var s=$("#keydetails "+r[i]),o=t.find(r[i]).attr("data-symbol");if(o){var u=KeybGen.getCharNumFromSymbol(o),a=parseInt(u,16)||"",f=KeybGen.getCharFromSymbol(o);s.html('<div class="char">'+f+"</div>"),s.append('<div class="code">'+a+"<br>"+u+"</div>");var l=KeybGen.unicode[u]||"";s.append('<p class="name">'+l+"</p>"),o.substring(0,2)=="U+"&&(o="U"+o.substring(2)),s.append('<p class="symbolname">'+o+"</p>")}}},KeybGen.changeGeometry=function(){$(this).parent().parent().find(".selected").removeClass("selected"),$(this).addClass("selected");var e=$('#symbols-select input[name="symbols"]:checked').val()||"pl_proposal",t=$("#keyboard .selected").data("keycode");KeybGen.generateKeyboard($(this).val(),e),t&&KeybGen.selectKey(t)},KeybGen.changeSymbols=function(){if($(this).hasClass("selected"))return;$(this).parent().parent().find(".selected").removeClass("selected"),$(this).addClass("selected");var e=$('#geometry-select input[name="geometry"]:checked').val()||"qwerty1",t=$("#keyboard .selected").data("keycode");KeybGen.generateKeyboard(e,$(this).val()),t&&KeybGen.selectKey(t),$("#diff-select").toggleClass("pl_proposal pl"),$("#diff-legend > div").toggle()},KeybGen.toggleDiff=function(){$("#keyboard").toggleClass("diff"),$("#diff-select input").toggleClass("selected"),$("#diff-legend").toggle(),$("#diff-legend > div").hide(),$("#diff-legend ."+$('#symbols-select input[name="symbols"]:checked').val()).show()},KeybGen.initHovers=function(){$("#keyboard").on("mouseenter",".alnum",function(){$(this).addClass("hovered")}),$("#keyboard").on("mouseleave",".alnum",function(){$(this).removeClass("hovered")})},KeybGen.initClicks=function(){$("#keyboard").on("click",".alnum",KeybGen.selectKey),$("#geometry-select input").click(KeybGen.changeGeometry),$("#symbols-select input").click(KeybGen.changeSymbols),$("#diff-select input").click(KeybGen.toggleDiff)},KeybGen.setGeometry=function(){var e=$('#geometry-select input[name="geometry"]:checked').val()||"qwerty1";return $('#geometry-select input[name="geometry"]').filter('[value="'+e+'"]').addClass("selected").attr("checked",!0),e},KeybGen.setLayout=function(){var e=$('#symbols-select input[name="symbols"]:checked').val()||"pl_proposal";return $('#symbols-select input[name="symbols"]').filter('[value="'+e+'"]').addClass("selected").attr("checked",!0),$("#diff-select").addClass(e),e};
